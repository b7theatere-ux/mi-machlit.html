<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Dice Challenge ??</title>
    <style>
        :root {
            --neon-blue: #38bdf8;
            --neon-purple: #818cf8;
            --neon-yellow: #fbbf24;
            --neon-green: #22c55e;
            --neon-red: #ef4444;
            --bg-dark: #0f172a;
        }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* סגנון הלוח והניקוד */
        .scoreboard {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .player-box {
            padding: 15px 25px;
            border: 2px solid #334155;
            border-radius: 12px;
            transition: all 0.3s;
            text-align: center;
            min-width: 120px;
        }

        .player-box.active {
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
            transform: scale(1.05);
        }

        /* רשת הקלפים */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 130px);
            gap: 15px;
            margin-bottom: 20px;
        }

        .card {
            width: 130px;
            height: 130px;
            background: #1e293b;
            border: 2px solid var(--neon-purple);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card.hidden {
            font-size: 0;
            background: #334155;
        }

        .card.hidden::after {
            content: attr(data-num);
            font-size: 35px;
            color: var(--neon-purple);
            opacity: 0.5;
        }

        /* אנימציות */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.4s ease-in-out;
            border-color: var(--neon-red) !important;
            box-shadow: 0 0 20px var(--neon-red) !important;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .success {
            animation: pulse 0.5s ease-in-out;
            border-color: var(--neon-green) !important;
            box-shadow: 0 0 25px var(--neon-green) !important;
        }

        /* כפתורים ובקרים */
        .controls {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        button {
            padding: 12px 35px;
            font-size: 20px;
            font-weight: bold;
            background: var(--neon-purple);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            transition: transform 0.2s;
        }

        button:active { transform: scale(0.95); }
        button:disabled { opacity: 0.4; cursor: not-allowed; }

        .dice-area { font-size: 60px; margin: 10px; min-height: 70px; transition: transform 0.5s; }
        .rolling { animation: shake 0.2s infinite; }

        .timer-bar {
            width: 300px;
            height: 10px;
            background: #334155;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 15px;
        }
        #progress {
            width: 100%;
            height: 100%;
            background: var(--neon-yellow);
            transition: width 0.1s linear;
        }
        .message { font-size: 22px; color: var(--neon-yellow); height: 35px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="scoreboard">
        <div id="p1-box" class="player-box active">שחקן 1<br><span id="s1">0</span> נק'</div>
        <div id="p2-box" class="player-box">שחקן 2<br><span id="s2">0</span> נק'</div>
    </div>

    <div class="message" id="msg">לחצו על "התחל סיבוב"</div>

    <div class="grid" id="grid"></div>

    <div class="controls">
        <div class="dice-area" id="dice">??</div>
        <button id="actionBtn" onclick="startRound()">התחל סיבוב</button>
        <div class="timer-bar"><div id="progress"></div></div>
    </div>

    <script>
        // בסיס הנתונים של הדמויות
        const allIcons = [
            "??", "??", "??", "??", "??", "??", "??", "??", 
            "??", "??", "??", "??", "??", "??", "??", "??", 
            "??", "??", "??", "??", "???????????", "??", "??", "??", "??", "??"
        ];

        let currentRoundIcons = [];
        let scores = [0, 0];
        let currentPlayer = 0;
        let targetIndex = -1;
        let canGuess = false;
        let timerInterval;

        // פונקציית סאונד (Web Audio API)
        function playSound(type) {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);

            if (type === 'success') {
                osc.frequency.setValueAtTime(523.25, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.3);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
                osc.start(); osc.stop(ctx.currentTime + 0.5);
            } else if (type === 'error') {
                osc.frequency.setValueAtTime(150, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
                osc.start(); osc.stop(ctx.currentTime + 0.4);
            } else if (type === 'tick') {
                osc.frequency.setValueAtTime(440, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                osc.start(); osc.stop(ctx.currentTime + 0.1);
            }
        }

        function renderCards(hide = false) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            currentRoundIcons.forEach((icon, i) => {
                const card = document.createElement('div');
                card.className = `card ${hide ? 'hidden' : ''}`;
                card.id = `card-${i}`;
                card.dataset.num = i + 1;
                card.textContent = icon;
                card.onclick = () => handleGuess(i);
                grid.appendChild(card);
            });
        }

        function startRound() {
            document.getElementById('actionBtn').disabled = true;
            currentRoundIcons = [...allIcons].sort(() => 0.5 - Math.random()).slice(0, 6);
            renderCards(false);
            document.getElementById('msg').textContent = "זכרו את הקלפים! (4 שניות)";
            
            startTimer(4, () => {
                renderCards(true);
                rollDice();
            });
        }

        function rollDice() {
            const dice = document.getElementById('dice');
            dice.classList.add('rolling');
            
            setTimeout(() => {
                dice.classList.remove('rolling');
                const diceRoll = Math.floor(Math.random() * 6) + 1;
                targetIndex = diceRoll - 1;
                dice.textContent = "?? " + diceRoll;
                document.getElementById('msg').textContent = `שחקן ${currentPlayer + 1}: איפה ה- ${currentRoundIcons[targetIndex]}?`;
                canGuess = true;
                
                startTimer(10, () => {
                    if(canGuess) endTurn(false, "נגמר הזמן!");
                });
            }, 600);
        }

        function handleGuess(index) {
            if (!canGuess) return;
            canGuess = false;
            clearInterval(timerInterval);
            
            const card = document.getElementById(`card-${index}`);
            if (index === targetIndex) {
                card.classList.add('success');
                playSound('success');
                endTurn(true, "כל הכבוד! +5");
            } else {
                card.classList.add('shake');
                playSound('error');
                endTurn(false, "טעות... -1");
            }
        }

        function endTurn(isCorrect, text) {
            renderCards(false); // חשיפת כל הקלפים
            if (isCorrect) scores[currentPlayer] += 5;
            else scores[currentPlayer] = Math.max(0, scores[currentPlayer] - 1);
            
            document.getElementById('msg').textContent = text;
            updateUI();
            
            setTimeout(() => {
                currentPlayer = currentPlayer === 0 ? 1 : 0;
                updateUI();
                document.getElementById('actionBtn').disabled = false;
                document.getElementById('actionBtn').textContent = "תור הבא";
                document.getElementById('msg').textContent = `תור שחקן ${currentPlayer + 1}`;
            }, 2500);
        }

        function updateUI() {
            document.getElementById('s1').textContent = scores[0];
            document.getElementById('s2').textContent = scores[1];
            document.getElementById('p1-box').className = currentPlayer === 0 ? 'player-box active' : 'player-box';
            document.getElementById('p2-box').className = currentPlayer === 1 ? 'player-box active' : 'player-box';
        }

        function startTimer(seconds, callback) {
            clearInterval(timerInterval);
            let timeLeft = seconds * 10;
            const total = seconds * 10;
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('progress').style.width = (timeLeft / total * 100) + "%";
                if (timeLeft < 30 && timeLeft % 10 === 0) playSound('tick');
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    callback();
                }
            }, 100);
        }

        // אתחול לוח ריק
        currentRoundIcons = ["?", "?", "?", "?", "?", "?"];
        renderCards(true);
    </script>
</body>
</html>